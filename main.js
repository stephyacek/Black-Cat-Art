/* eslint-disable no-unused-vars */
var products = [
  {
    image: 'images/turquoise.jpg',
    title: 'Something With Turquoise',
    description: 'This original signed photograph is professionally printed at a lab on archival photography paper.',
    size:
    {
      small: 'Small: 8x8 inches Unframed Print (approx 20.3cm sq.)',
      medium: 'Medium: 10x10 inches Unframed Print (approx 25.4cm sq.)',
      large: 'Large: 12x12 inches Unframed Print (approx 30.4cm sq.)'
    },
    price: 'Small: $16.99 | Medium: $19.99 | Large: $22.99',
    id: 0
  },
  {
    image: 'images/rolling.jpg',
    title: 'Risible Rollings',
    description: 'This original signed photograph is professionally printed at a lab on archival photography paper.',
    size:
    {
      small: 'Small: 8x8 inches Unframed Print (approx 20.3cm sq.)',
      medium: 'Medium: 10x10 inches Unframed Print (approx 25.4cm sq.)',
      large: 'Large: 12x12 inches Unframed Print (approx 30.4cm sq.)'
    },
    price: 'Small: $16.99 | Medium: $19.99 | Large: $22.99',
    id: 1
  },
  {
    image: 'images/serpentine.jpg',
    title: 'Serpentine and Sarcastic',
    description: 'This original signed photograph is professionally printed at a lab on archival photography paper.',
    size:
    {
      small: 'Small: 8x8 inches Unframed Print (approx 20.3cm sq.)',
      medium: 'Medium: 10x10 inches Unframed Print (approx 25.4cm sq.)',
      large: 'Large: 12x12 inches Unframed Print (approx 30.4cm sq.)'
    },
    price: 'Small: $16.99 | Medium: $19.99 | Large: $22.99',
    id: 2
  },
  {
    image: 'images/claws.jpg',
    title: 'Corpulent Claws',
    description: 'This original signed photograph is professionally printed at a lab on archival photography paper.',
    size:
    {
      small: 'Small: 8x8 inches Unframed Print (approx 20.3cm sq.)',
      medium: 'Medium: 10x10 inches Unframed Print (approx 25.4cm sq.)',
      large: 'Large: 12x12 inches Unframed Print (approx 30.4cm sq.)'
    },
    price: 'Small: $16.99 | Medium: $19.99 | Large: $22.99',
    id: 3
  },
  {
    image: 'images/scarlet.jpg',
    title: 'Scarlet Sartorial Sense',
    description: 'This original signed photograph is professionally printed at a lab on archival photography paper.',
    size:
    {
      small: 'Small: 8x8 inches Unframed Print (approx 20.3cm sq.)',
      medium: 'Medium: 10x10 inches Unframed Print (approx 25.4cm sq.)',
      large: 'Large: 12x12 inches Unframed Print (approx 30.4cm sq.)'
    },
    price: 'Small: $16.99 | Medium: $19.99 | Large: $22.99',
    id: 4
  },
  {
    image: 'images/fulsome.jpg',
    title: 'Fulsome Fur',
    description: 'This original signed photograph is professionally printed at a lab on archival photography paper.',
    size:
    {
      small: 'Small: 8x8 inches Unframed Print (approx 20.3cm sq.)',
      medium: 'Medium: 10x10 inches Unframed Print (approx 25.4cm sq.)',
      large: 'Large: 12x12 inches Unframed Print (approx 30.4cm sq.)'
    },
    price: 'Small: $16.99 | Medium: $19.99 | Large: $22.99',
    id: 5

  },
  {
    image: 'images/zealous.jpg',
    title: 'Zealous Eater',
    description: 'This original signed photograph is professionally printed at a lab on archival photography paper.',
    size:
    {
      small: 'Small: 8x8 inches Unframed Print (approx 20.3cm sq.)',
      medium: 'Medium: 10x10 inches Unframed Print (approx 25.4cm sq.)',
      large: 'Large: 12x12 inches Unframed Print (approx 30.4cm sq.)'
    },
    price: 'Small: $16.99 | Medium: $19.99 | Large: $22.99',
    id: 6
  },
  {
    image: 'images/fuschia.jpg',
    title: 'Flaming Fuschia',
    description: 'This original signed photograph is professionally printed at a lab on archival photography paper.',
    size:
    {
      small: 'Small: 8x8 inches Unframed Print (approx 20.3cm sq.)',
      medium: 'Medium: 10x10 inches Unframed Print (approx 25.4cm sq.)',
      large: 'Large: 12x12 inches Unframed Print (approx 30.4cm sq.)'
    },
    price: 'Small: $16.99 | Medium: $19.99 | Large: $22.99',
    id: 7
  },
  {
    image: 'images/chiaroscuro.jpg',
    title: 'Chiaroscuro',
    description: 'This original signed photograph is professionally printed at a lab on archival photography paper.',
    size:
    {
      small: 'Small: 8x8 inches Unframed Print (approx 20.3cm sq.)',
      medium: 'Medium: 10x10 inches Unframed Print (approx 25.4cm sq.)',
      large: 'Large: 12x12 inches Unframed Print (approx 30.4cm sq.)'
    },
    price: 'Small: $16.99 | Medium: $19.99 | Large: $22.99',
    id: 8
  },
  {
    image: 'images/valiant.jpg',
    title: 'Valiant Vocalist',
    description: 'This original signed photograph is professionally printed at a lab on archival photography paper.',
    size:
    {
      small: 'Small: 8x8 inches Unframed Print (approx 20.3cm sq.)',
      medium: 'Medium: 10x10 inches Unframed Print (approx 25.4cm sq.)',
      large: 'Large: 12x12 inches Unframed Print (approx 30.4cm sq.)'
    },
    price: 'Small: $16.99 | Medium: $19.99 | Large: $22.99',
    id: 9
  },
  {
    image: 'images/energetic.jpg',
    title: 'Energetic Enigma',
    description: 'This original signed photograph is professionally printed at a lab on archival photography paper.',
    size:
    {
      small: 'Small: 8x8 inches Unframed Print (approx 20.3cm sq.)',
      medium: 'Medium: 10x10 inches Unframed Print (approx 25.4cm sq.)',
      large: 'Large: 12x12 inches Unframed Print (approx 30.4cm sq.)'
    },
    price: 'Small: $16.99 | Medium: $19.99 | Large: $22.99',
    id: 10
  },
  {
    image: 'images/curiosity.jpg',
    title: 'Capricious Curiosity',
    description: 'This original signed photograph is professionally printed at a lab on archival photography paper.',
    size:
    {
      small: 'Small: 8x8 inches Unframed Print (approx 20.3cm sq.)',
      medium: 'Medium: 10x10 inches Unframed Print (approx 25.4cm sq.)',
      large: 'Large: 12x12 inches Unframed Print (approx 30.4cm sq.)'
    },
    price: 'Small: $16.99 | Medium: $19.99 | Large: $22.99',
    id: 11
  }
]

var $siteDescription = document.querySelector('.site-description')
var $cartNav = document.querySelector('.cart-nav')
var $artworkSection = document.querySelector('.artwork')
var $products = document.getElementsByClassName('product')
var $images = document.getElementsByClassName('artwork-image')
var $productDescriptions = document.getElementsByClassName('product-description')
var $artDetailPage = document.querySelector('.artwork-detail-page')
var $myCart = document.querySelector('.my-cart')
var $cartData = document.querySelector('.cart-data')
var $cartCalculation = document.querySelector('.cart-calculation')
var $tableHeading = document.querySelector('.table-heading')
var $backButton = document.querySelector('.back-button')

document.addEventListener('DOMContentLoaded', function () {
  renderCartNav()
  renderBackButton($backButton)
  renderPhotos(products)
  addClickEvent($images)
  addClickEvent($productDescriptions)
})

function addClickEvent(elements) {
  for (var i = 0; i < elements.length; i++) {
    elements[i].addEventListener('click', function () {
      var id = event.target.getAttribute('data-id')
      renderProductById(products, id)
      window.scrollTo(0, 0)
    })
  }
}

function createEachProduct(product, productId) {
  var $product = document.createElement('span')
  var $productDescription = document.createElement('span')
  var $image = document.createElement('img')

  $productDescription.setAttribute('class', 'product-description')
  $productDescription.setAttribute('data-id', product.id)
  $productDescription.textContent = product.title

  $image.setAttribute('src', product.image)
  $image.setAttribute('class', 'artwork-image')
  $image.setAttribute('data-id', product.id)

  $product.setAttribute('class', 'product')
  $product.setAttribute('data-id', product.id)
  $product.appendChild($image)
  $product.appendChild($productDescription)

  return $product
}

function renderCartNav() {
  var $goToCart = document.createElement('img')
  var $numberInCart = document.createElement('span')
  var $emptyCart = document.createElement('span')

  $emptyCart.setAttribute('class', 'hidden empty-cart')
  $emptyCart.textContent = 'No items in cart!'
  $numberInCart.setAttribute('class', 'number-in-cart')
  $numberInCart.textContent = getTotalQuantities(cartContents)
  $goToCart.setAttribute('src', 'cart.png')
  $goToCart.setAttribute('class', 'cart-glyph')
  $cartNav.addEventListener('click', seeMyCart)

  $cartNav.appendChild($emptyCart)
  $cartNav.appendChild($goToCart)
  $cartNav.appendChild($numberInCart)

  return $goToCart
}

function renderPhotos(product) {
  for (var i = 0; i < product.length; i++) {
    var $product = createEachProduct(product[i])
    $artworkSection.appendChild($product)
  }
}

function renderBackButton(parentElement) {
  var $detailNavBar = document.createElement('span')
  var $back = document.createElement('span')

  $detailNavBar.setAttribute('class', 'detail-nav-bar')
  $detailNavBar.appendChild($back)
  $back.setAttribute('class', 'back')
  $back.textContent = 'Home'
  $back.addEventListener('click', goBack)

  parentElement.appendChild($detailNavBar)
}

function renderArtwork(artwork) {
  var $detailNavBar = document.querySelector('.detail-nav-bar')
  var $printContainer = document.createElement('span')
  var $print = document.createElement('img')
  var $productDetailsContainer = document.createElement('span')
  var $titleContainer = document.createElement('span')
  var $title = document.createElement('h2')
  var $message = document.createElement('span')

  $printContainer.setAttribute('class', 'product-detail')
  $printContainer.appendChild($print)
  $print.setAttribute('src', artwork.image)

  $titleContainer.setAttribute('class', 'product-title-detail')
  $titleContainer.appendChild($title)
  $title.textContent = artwork.title

  $message.setAttribute('class', 'alert-message not-visible')
  $message.textContent = 'Be sure to choose size and quantity before adding to cart!'

  $productDetailsContainer.setAttribute('class', 'product-details-container')
  $productDetailsContainer.appendChild($titleContainer)
  $productDetailsContainer.appendChild(createArtDetail('product-summary-detail', artwork.description))
  $productDetailsContainer.appendChild(createArtDetail('product-size-detail', artwork.size.small))
  $productDetailsContainer.appendChild(createArtDetail('product-size-detail', artwork.size.medium))
  $productDetailsContainer.appendChild(createArtDetail('product-size-detail', artwork.size.large))
  $productDetailsContainer.appendChild(createArtDetail('product-price-detail', artwork.price))
  $productDetailsContainer.appendChild(renderPurchaseContainer())
  $productDetailsContainer.appendChild($message)

  $artDetailPage.appendChild($printContainer)
  $artDetailPage.appendChild($productDetailsContainer)
  return $artDetailPage
}

function createArtDetail(className, detail) {
  var artDetail = document.createElement('span')
  artDetail.setAttribute('class', className)
  artDetail.textContent = detail
  return artDetail
}

function renderProductById(allProducts, desiredId) {
  var match = allProducts[parseInt(desiredId)]
  if (match != null) {
    $artworkSection.classList.add('hidden')
    $siteDescription.classList.add('hidden')
    $artDetailPage.classList.remove('hidden')
    renderArtwork(match)
    addIdToCart(match)
  }
}

function renderPurchaseContainer() {
  var $purchaseContainer = document.createElement('span')
  var $dropdown = document.createElement('select')
  var $chooseSize = document.createElement('option')
  var $chooseSm = document.createElement('option')
  var $chooseMd = document.createElement('option')
  var $chooseLg = document.createElement('option')
  var $quantity = document.createElement('input')
  var $addToCart = document.createElement('button')

  $purchaseContainer.setAttribute('class', 'purchase-container')
  $purchaseContainer.appendChild($dropdown)
  $purchaseContainer.appendChild($quantity)
  $purchaseContainer.appendChild($addToCart)

  $dropdown.setAttribute('class', 'dropdown')
  $dropdown.appendChild($chooseSize)
  $dropdown.appendChild($chooseSm)
  $dropdown.appendChild($chooseMd)
  $dropdown.appendChild($chooseLg)

  $chooseSize.setAttribute('value', '0')
  $chooseSize.textContent = 'Choose Size'
  $chooseSm.setAttribute('value', 16.99)
  $chooseSm.textContent = 'Small'
  $chooseMd.setAttribute('value', 19.99)
  $chooseMd.textContent = 'Medium'
  $chooseLg.setAttribute('value', 22.99)
  $chooseLg.textContent = 'Large'

  $quantity.setAttribute('id', 'quantity')
  $quantity.setAttribute('type', 'number')
  $quantity.setAttribute('min', 0)
  $quantity.setAttribute('placeholder', 'Quantity')

  $addToCart.setAttribute('class', 'button')
  $addToCart.setAttribute('class', 'add-to-cart')
  $addToCart.textContent = 'Add to Cart'
  $addToCart.addEventListener('click', addToCart)

  return $purchaseContainer
}

function renderMyCartItems(cartItem) {
  var $dataRow = document.createElement('div')
  var $cartPrint = document.createElement('span')
  var $cartPhoto = document.createElement('img')
  var $cartTitle = document.createElement('span')
  var $cartPrice = document.createElement('span')
  var $cartQuantity = document.createElement('span')
  var $cartQuantityChange = document.createElement('span')
  var $cartChangeQuantity = document.createElement('input')
  var $cartQuantityButton = document.createElement('button')
  var $cartDelete = document.createElement('span')
  var $cartDeleteItem = document.createElement('img')
  var $cartDeleteText = document.createElement('span')
  var $cartRowTotal = document.createElement('span')
  var productInfo = getProductInfo(cartItem.id)

  $dataRow.setAttribute('class', 'data')
  $dataRow.appendChild($cartPrint)
  $dataRow.appendChild($cartTitle)
  $dataRow.appendChild($cartPrice)
  $dataRow.appendChild($cartQuantity)
  $dataRow.appendChild($cartQuantityChange)
  $dataRow.appendChild($cartDelete)
  $dataRow.appendChild($cartRowTotal)

  $cartPrint.setAttribute('class', 'cart-print')
  $cartPrint.appendChild($cartPhoto)
  $cartPhoto.setAttribute('src', productInfo.image)

  $cartTitle.setAttribute('class', 'cart-title')
  $cartTitle.textContent = productInfo.title

  $cartPrice.textContent = '$' + cartItem.price

  $cartQuantity.textContent = cartItem.quantity

  $cartChangeQuantity.setAttribute('class', 'change-quantity')
  $cartChangeQuantity.setAttribute('type', 'number')
  $cartChangeQuantity.setAttribute('min', 0)
  $cartChangeQuantity.setAttribute('max', 99)
  $cartQuantityButton.setAttribute('class', 'button')
  $cartQuantityButton.setAttribute('class', 'cart-update')
  $cartQuantityButton.setAttribute('product-id', cartItem.id)
  $cartQuantityButton.setAttribute('product-price', cartItem.price)
  $cartQuantityButton.textContent = 'Update'
  $cartQuantityChange.appendChild($cartChangeQuantity)
  $cartQuantityChange.appendChild($cartQuantityButton)
  $cartQuantityButton.addEventListener('click', updateCart)

  $cartDeleteItem.setAttribute('src', 'images/delete.png')
  $cartDeleteItem.setAttribute('class', 'delete-item')
  $cartDeleteText.setAttribute('class', 'delete-text')
  $cartDeleteText.textContent = 'Delete'
  $cartDelete.setAttribute('class', 'delete-section')
  $cartDelete.setAttribute('product-id', cartItem.id)
  $cartDelete.setAttribute('product-price', cartItem.price)
  $cartDelete.appendChild($cartDeleteItem)
  $cartDelete.appendChild($cartDeleteText)
  $cartDelete.addEventListener('click', deleteRow)

  $cartRowTotal.setAttribute('class', 'row-total')
  $cartRowTotal.textContent = calculateMultiply(cartItem.price, cartItem.quantity)
  $cartData.appendChild($dataRow)
}

function renderMyCartTotal() {
  var $cartSubtotal = document.createElement('div')
  var $cartTax = document.createElement('div')
  var $cartTotal = document.createElement('div')
  var $buttonToCheckout = document.createElement('button')

  $cartSubtotal.setAttribute('class', 'cart-subtotal')
  $cartSubtotal.innerHTML = 'Subtotal: $ ' + Number(calculateSum('row-total').toFixed(2))

  $cartTax.setAttribute('class', 'cart-tax')
  $cartTax.innerHTML = 'Tax (8%): $' + Number(((calculateSum('row-total') * 0.08)).toFixed(2))

  $cartTotal.setAttribute('class', 'cart-total')
  $cartTotal.innerHTML = 'Total: $ ' + Number(((calculateSum('row-total') * 1.08)).toFixed(2))

  $buttonToCheckout.setAttribute('class', 'button button-to-checkout')
  $buttonToCheckout.textContent = 'Checkout'

  $cartCalculation.appendChild($cartSubtotal)
  $cartCalculation.appendChild($cartTax)
  $cartCalculation.appendChild($cartTotal)
  $cartCalculation.appendChild($buttonToCheckout)
}

function calculateMultiply(price, quantity) {
  var subtotal = Number(price) * Number(quantity)
  return subtotal.toFixed(2)
}

function calculateSum(subtotalClass) {
  var total = 0
  var subtotals = document.getElementsByClassName(subtotalClass)
  for (var i = 0; i < subtotals.length; i++) {
    total += Number(subtotals[i].innerHTML)
  }
  return total
}

function addIdToCart(identifier) {
  var $addToCart = document.querySelector('.add-to-cart')
  $addToCart.setAttribute('data-id', identifier.id)
  return $addToCart
}

var cartContents = []

function addToCart(event) {
  var size = document.querySelector('.dropdown')
  var quantity = document.querySelector('#quantity')
  var print = document.querySelector('.add-to-cart')
  var numberInCart = document.querySelector('.number-in-cart')
  var message = document.querySelector('.alert-message')
  var emptyCart = document.querySelector('.empty-cart')
  var cartItem = {
    id: print.dataset.id,
    price: size.value,
    quantity: Number(quantity.value)
  }
  if (Number(size.value) !== 0 && quantity.value > 0 && quantity.value !== '') {
    var itemIndex = findCartItem(cartContents, cartItem.id)
    if (itemIndex != null && cartContents[itemIndex].price === cartItem.price) {
      cartContents[itemIndex].quantity += Number(cartItem.quantity)
    }
    else {
      cartContents.push(cartItem)
    }
    message.classList.add('not-visible')
    emptyCart.classList.add('hidden')
    numberInCart.textContent = getTotalQuantities(cartContents)
    quantity.value = ''
    size.value = 0
  }
  else {
    message.classList.remove('not-visible')
  }
}

function seeMyCart(event) {
  var $emptyCart = document.querySelector('.empty-cart')
  clearCart()
  if (cartContents.length === 0) {
    $emptyCart.classList.remove('hidden')
  }
  else {
    var $cartData = document.querySelector('.cart-data')
    $artworkSection.classList.add('hidden')
    $siteDescription.classList.add('hidden')
    $artDetailPage.classList.add('hidden')
    $artDetailPage.innerHTML = ''
    $myCart.classList.remove('hidden')
    cartContents.forEach(function (item) {
      renderMyCartItems(item)
    })
    renderMyCartTotal()
    window.scrollTo(0, 0)
  }
}

function goBack(event) {
  $artworkSection.classList.remove('hidden')
  $siteDescription.classList.remove('hidden')
  hideSection($myCart)
  clearCart()
  hideSection($artDetailPage)
  window.scrollTo(0, 0)
}

function hideSection(section) {
  if (!section.classList.contains('hidden')) {
    section.classList.add('hidden')
  }
}

function deleteRow(event) {
  var numberInCart = document.querySelector('.number-in-cart')
  var productId = event.target.parentNode.getAttribute('product-id')
  var productPrice = event.target.parentNode.getAttribute('product-price')
  for (var i = 0; i < cartContents.length; i++) {
    if (cartContents[i].price === productPrice && cartContents[i].id === productId) {
      cartContents.splice(i, 1)
    }
  }
  clearCart()
  numberInCart.textContent = getTotalQuantities(cartContents)
  cartContents.forEach(function (item) {
    renderMyCartItems(item)
  })
  renderMyCartTotal()
}

function updateCart(event) {
  var numberInCart = document.querySelector('.number-in-cart')
  var productId = event.target.getAttribute('product-id')
  var productPrice = event.target.getAttribute('product-price')
  var newQuantity = event.target.parentNode.firstChild.value

  for (var i = 0; i < cartContents.length; i++) {
    if (cartContents[i].id === productId && cartContents[i].price === productPrice) {
      if (Number(newQuantity) > 0) {
        cartContents[i].quantity = newQuantity
      }
      else {
        cartContents.splice(i, 1)
      }
    }
  }

  clearCart()
  cartContents.forEach(function (item) {
    renderMyCartItems(item)
  })

  numberInCart.textContent = getTotalQuantities(cartContents)
  renderMyCartTotal()
}

function getTotalQuantities(cart) {
  var total = 0
  for (var i = 0; i < cart.length; i++) {
    total += Number(cart[i].quantity)
  }
  return total
}

function getProductInfo(productId) {
  if (productId >= 0) {
    return products[productId]
  }
}

function findCartItem(cartItems, productId) {
  for (var i = 0; i < cartItems.length; i++) {
    if (cartItems[i].id === productId) {
      return i
    }
  }
  return null
}

function clearCart() {
  $cartData.innerHTML = ''
  $cartCalculation.innerHTML = ''
}
